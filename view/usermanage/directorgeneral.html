<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>用户管理</title>
    <link href="../../bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--<link rel="stylesheet" href="../../css/common.css">-->
    <link rel="stylesheet" href="css/usermanage.css">
    <link rel="stylesheet" href="css/schoolmanagerAdd.css">
    <link rel="stylesheet" href="css/researcher.css">
    <link rel="stylesheet" href="../../css/kkpager_blue.css">
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<div class="header">
    <div class="headerleft pull-left ">
        <div class="headerText pull-left "><span>搜索类型：</span></div>
        <div class="formstyle pull-left">
            <select class="form-control" id="headerLeftSEL">
                <option value="1">手机号码</option>
                <option value="2">姓名</option>
                <option value="3">用户id</option>
            </select>
        </div>
        <div class="headerinput input-group pull-left">
            <input type="text" class="form-control" placeholder="">
        </div>
    </div>
    <!--三级联动-->
    <div class="headerright pull-right">
        <div class="headerText pull-left  searchText"><span>选择学校：</span></div>
        <div class="formstyle pull-left proviceSelect">
            <select class="form-control" id="selProvice">
                <option value="省/市">省/市</option>
            </select>
        </div>
        <div class="formstyle pull-left citySelect">
            <select class="form-control pull-left" id="selCity">
                <option value="市">市</option>
            </select>
        </div>
        <div class="formstyle pull-left countrySelect">
            <select class="form-control pull-left" id="selCounty">
                <option value="区/县">区/县</option>
            </select>
        </div>
        <!--<div class="formstyle pull-left scoolSelect">
            <select class="form-control pull-left" id="selSchool">
                <option>选择学校</option>
            </select>
        </div>-->
    </div>
    <!--查询重置按钮-->
    <div class="btns">
        <button  type="button" class="btn btn-info btnSearch">查询</button>
        <button  type="button" class="btn btn-info btnReset">重置</button>
        <button  type="button" class="btn btn-info newButton">新增</button>
    </div>
</div>
<div class="content">
    <div class="contenttable">
        <table class="table table-bordered table-hover">
            <tr>
                <th>序号</th>
                <th>用户id</th>
                <th>姓名</th>
                <th>手机号</th>
                <th>区域</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
           <!-- <tr>
                <td>1</td>
                <td>321321</td>
                <td>单小楠</td>
                <td>15632323232</td>
                <td>北京四中</td>
                <td>北京市朝阳区</td>
                <td><a href="javascript:;">编辑重置密码</a></td>
            </tr>
            <tr>
                <td>2</td>
                <td>321321</td>
                <td>单小楠</td>
                <td>15632323232</td>
                <td>北京四中</td>
                <td>北京市朝阳区</td>
                <td><a href="javascript:;">编辑重置密码</a></td>
            </tr>-->
        </table>
        <div id="kkpager"></div>
    </div>
</div>
<!--新增局长-->
<div class='newAdd'>
    <div class="formtable">
        <form action="" class="form-inline">
            <div class="form-group">
                <label for="username">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;姓 &nbsp;名：</label>
                <input type="username" class="form-control" id="username" placeholder="请输入姓名">
            </div>
            <br>
            <div class="form-group">
                <label for="phone">&nbsp;&nbsp;&nbsp;&nbsp;手机号：</label>
                <input type="text" class="form-control" id="phone" placeholder="请输入手机号码">
            </div>
            <br>
            <div class="form-group">
                <!-- <div class="headerText pull-left"><span>选择学校：</span></div>-->
               <!-- <label class="pull-left">负责区域：</label>-->
                <span style="font-weight: 700;">负责区域：&nbsp</span>
                    <select class="form-control" id="selProvice1">
                        <option value="省/市">省/市</option>
                    </select>
                    <select class="form-control" id="selCity1">
                        <option value="市">市</option>
                    </select>
                    <select class="form-control" id="selCounty1">
                        <option id="区/县">区/县</option>
                    </select>
            </div>
            <br>
            <br>
            <button type="button" class="btn btn-info cancelBtn" >取消</button>
            <button type="submit" class="btn btn-info addBtn">创建</button>
        </form>
    </div>
</div>
<!--获取局长详情 编辑 删除-->
<div class="directorgeneralDetil">
    <div class="directorgeneralDetilTable">
        <table class="table table-bordered table-hover">
            <tr>
                <th>序号</th>
                <th>用户id</th>
                <th>姓名</th>
                <th>手机号</th>
                <th>区域id</th>
                <th>学校区域</th>
            </tr>
        </table>
    </div>
    <!--<button class="btn btn-info directorgeneralAmend">修改</button>
    <button class="btn btn-info directorgeneralDelete">删除</button>-->
    <button class="btn btn-info directorgeneralBack">返回</button>
</div>
<!--局长修改-->
<div class="dir_DetilAmend">
   <!-- <div class="form-group schoolUsername">
        <label for="dir_usernameAmend">姓名：</label>
        <input type="username" class="form-control" id="dir_usernameAmend" placeholder="请输入姓名">
    </div>
    <div class="form-group schoolUsername">
        <label for="dir_moblieAmend">手机号：</label>
        <input type="username" class="form-control" id="dir_moblieAmend" placeholder="请输入姓名">
    </div>
    //选择地区
    <div class="form-group schoolSelect">
        <span style="font-weight: 700;">选择学校：&nbsp</span>
        <select class="form-control" id="selProvice2">
            <option value="">省/市</option>
        </select>
        <select class="form-control" id="selCity2">
            <option value="">市</option>
        </select>
        <select class="form-control" id="selCounty2">
            <option value="">区/县</option>
        </select>
    </div>
    <br>-->
    <div class="formtable">
        <form action="" class="form-inline">
            <div class="form-group">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label for="dir_Detilusername"> &nbsp;&nbsp;姓名：</label>
                <input type="username" class="form-control" id="dir_Detilusername" placeholder="请输入姓名">
            </div>
            <br>
            <div class="form-group">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label for="dir_Detilpassword"> &nbsp;&nbsp;密码：</label>
                <input type="password" class="form-control" id="dir_Detilpassword" placeholder="请输入密码">
            </div>
            <br>
            <div class="form-group">
                &nbsp;&nbsp; &nbsp;<label for="dir_Detilphone"> 手机号：</label>
                <input type="text" class="form-control" id="dir_Detilphone" placeholder="请输入手机号码">
            </div>
            <br>
            <div class="form-group">
                <!-- <div class="headerText pull-left"><span>选择学校：</span></div>-->
                <!-- <label class="pull-left">负责区域：</label>-->
                <span style="font-weight: 700;">负责区域：&nbsp</span>
                <select class="form-control" id="selProvice2">
                    <option value="省/市">省/市</option>
                </select>
                <select class="form-control" id="selCity2">
                    <option value="市">市</option>
                </select>
                <select class="form-control" id="selCounty2">
                    <option value="区/县">区/县</option>
                </select>
            </div>
            <br>
            <br>
            <button type="button" class="btn btn-info cancelBtnAmend">取消</button>
            <button type="submit" class="btn btn-info addBtnAmend">修改</button>
        </form>
    </div>

</div>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script type="text/javascript" src="js/base.js"></script>
<script src="../../scripts/jquery-1.12.3.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../../bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../login/js/md5.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="../../scripts/kkpager.js"></script>
<script type="text/javascript" src="../../scripts/layer.js"></script>
<script type="text/javascript" src="js/directorgeneral.js"></script>
<script type="text/javascript" src="js/directorgeneralAdd.js"></script>
<script type="text/javascript">
    /*//局长 修改 删除*/
    $(function(){
        var $table = $('.contenttable table');
        var $amend = $('.directorgeneralAmend');
        var $delete = $('.directorgeneralDelete');
        var $back = $('.directorgeneralBack');
        var $detiltable = $('.directorgeneralDetilTable table');

        var $amendPage = $('.dir_DetilAmend');//修改页
        var $detil  = $('.directorgeneralDetil');
        var $btnAmend = $('.addBtnAmend');
        var $schoolid = '';
        var $selprovince = $('#selProvice2');
        var $selcity = $('#selCity2');
        var $selCounty = $('#selCounty2');
        var url = '/boss/common/get_area';
        var $areid = '';
        var params = {//获取详情参数
            "access_token": '',
            "mobile": "",
            "password": ""
        };
        var paramD = { // 删除参数
            "access_token": "",
            "id": ""
        };
        var paramA = { // 修改参数
            "access_token": "",
            "id": "",
            "password": " acTkmkrgquzcqzm2mda5q0",	//可选（md5加密）
            "fullName": "呵呵",		//可选
            "mobile": "",		//可选
            "areaId": 1			//可选
        };
        params.access_token = window.sessionStorage.getItem("access_token");
        paramD.access_token = window.sessionStorage.getItem("access_token");
        paramA.access_token = window.sessionStorage.getItem("access_token");
        //获取详情
        $table.delegate('.check','click',function(){
            $('.header').hide();
            $('.content').hide();
            $('.directorgeneralDetil').show();
            $('.directorgeneralDetilTable tr:not(:first)').remove();
            params.mobile = $(this).parent().parent().attr('mobile');
            params.password = $(this).parent().parent().attr('password');
            $.ajax({
                url:basepath + '/boss/director/detail',
                type : 'POST',
                dataType:"json",
                data :{params :JSON.stringify(params)},
                success:function(data){
                    if(data.httpCode == '200'){
                        var item = data.result;
                        /*paramD.id = item.id;*/
                        /*getDres(paramA,item);*///获取修改页所需参数
                        var trs = '';
                        trs += '<tr> <td>'+ 1 + '</td><td>'+ item.id + '</td> <td>' + item.fullName + '</td> <td>' + item.mobile + '</td> <td>' + item.areaId + '</td> <td>' + item.areaName + '</td></tr>'
                        $detiltable.append(trs);
                    }else if(data.httpCode == '709'){
                        window.sessionStorage.removeItem("access_token");
                        window.sessionStorage.removeItem("username");
                        window.location.href="./../../login/login.html";
                    }
                },
                error:function(error){
                    console.log(error);
                }
            });

        });

        //删除
        $table.delegate('.delete','click',function(){
            paramD.id = $(this).parent().parent().attr('id');
            var delorrenew = '';
            if ($(this).parent().parent().attr('status') == 0){
                paramD.status = 1;
                delorrenew = "恢复";
            }else {
                paramD.status = 0;
                delorrenew = "删除";
            }
            layer.open({
                content: '您确定要'+ delorrenew +'吗？'
                ,btn: ['确定', '取消']
                , style: 'width:200px;height:90px'
                ,yes: function(){
                    deleteDir(paramD);
                }
            });

        });
        function deleteDir (paramD){
            $.ajax({
                url:basepath + '/boss/director/delete',
                type : 'POST',
                dataType:"json",
                data :{params :JSON.stringify(paramD)},
                success:function(data){
                    if(data.httpCode == '200'){
                        if(paramD.status == 1){
                            tip('恢复成功');
                        }else {
                            tip('删除成功');
                        }
                        delete paramD.status;
                        delete paramD.id;
                        window.setTimeout(function(){
                            $('.btnSearch').click();
                        },2000);

                    }
                },
                error:function(erro){
                    console.log(erro);
                }
            });
        }

        //返回
        $back.on('click',function(){
            $('.header').show();
            $('.content').show();
            $('.directorgeneralDetil').hide();
        });


        //修改￥￥￥￥￥￥￥￥￥￥￥￥￥￥
        $('#dir_Detilphone').blur(function(){
            if(this.value.trim()){
                var  re = /^1\d{10}$/;
                if(!re.test(this.value.trim())){
                    tip('手机号码格式错误,请重新输入');
                    $(this).val('');
                    return
                }
            }
        });
        $table.delegate('.modify','click',function(){
            var item = {};
            item.id = $(this).parent().parent().attr("id");
            item.password = $(this).parent().parent().attr("password");
            item.fullName = $(this).parent().parent().attr("fullName");
            item.mobile = $(this).parent().parent().attr("mobile");
            item.areaId = $(this).parent().parent().attr("areaId");
            var proName = $(this).attr('provinceName');//回显省市县
            var citName = $(this).attr('cityName');
            var counName = $(this).attr('areaName');
            $('#selProvice2 option:first').text(proName);
            $('#selCity2 option:first').text(citName);
            $('#selCity2').attr('disabled','true');
            $('#selCounty2 option:first').text(counName);
            $('#selCounty2').attr('disabled','true');


            getDres(paramA,item);
            $('#dir_Detilusername').val(paramA.fullName);
            $('#dir_Detilphone').val(paramA.mobile);
            /*$('#dir_Detilpassword').val(paramA.password);*/

            $amendPage.show();
            $(".content").hide();
            $('.header').hide();
            console.log('开始修改');

        });
        //取消修改
        $(".cancelBtnAmend").on('click',function(){
            $amendPage.hide();
            $detil.hide();
            $(".content").show();
            $('.header').show();
            $('.btnSearch').click();
            idclear();
        });
        //修改中
        $('#selCounty2').change(function(){
            $areid = this.value;
        });
        /*获取页面输入数据*/
        /*$('#usernameAmend').blur(function(){

        });*/

        $btnAmend.on('click',function(event){
            event.preventDefault();
            if($('#dir_Detilusername').val().trim()!== ''){
                paramA.fullName = $('#dir_Detilusername').val().trim();
            }
            if($('#dir_Detilpassword').val().trim() != ''){
                paramA.password = hex_md5($('#dir_Detilpassword').val().trim());
            }
            if($('#dir_Detilphone').val().trim() != ''){
                paramA.mobile = $('#dir_Detilphone').val().trim();
            }
            if($areid){
                paramA.areaId = $areid;
            }
            console.log(paramA);
            $.ajax({
                url:basepath + '/boss/director/modify',
                type : 'POST',
                dataType:"json",
                data :{params :JSON.stringify(paramA)},
                success:function(data){
                    if(data.httpCode == '200'){
                        tip('修改完成');
                        $areid = '';
                        $amendPage.hide();
                        $('.header').show();
                        $('.content').show();
                        idclear();
                        window.setTimeout(function(){
                            $('.btnSearch').click();
                        },2000);
                    }else if(data.httpCode == '40002'){
                        layer.closeAll();
                        tip('参数不全，请选择完全参数');
                    }
                }
            });
        });

        //获取schollid 三级联动
        /* var $selprovince = $('#selProvice2');
         var $selcity = $('#selCity2');
         var $selCounty = $('#selCounty2');*/
        var paramSchoolid= {
            areaId :0
        };
        $selprovince.on("click",function(){
            $('#selProvice2 option:first').text("省/市");
        });
        getarea(paramSchoolid,$selprovince,url);
        $selprovince.change(function(){
            $selcity.children('option:not(:first)').remove();
            $selCounty.children('option:not(:first)').remove();
            $selcity.children('option:first').text("市");
            $selcity.removeAttr("disabled");
            if(this.value == "省/市"){
                return
            }
            delete paramA.areaId;
            paramSchoolid.areaId = this.value;
            getarea(paramSchoolid,$selcity,url);
        });
        $selcity.change(function(){
            $selCounty.children('option:not(:first)').remove();
            $selCounty.children('option:first').text("区/县");
            $selCounty.removeAttr("disabled");
            if(this.value == "市"){
                return
            }
            paramSchoolid.areaId = this.value;
            getarea(paramSchoolid,$selCounty,url)
        });
        $selCounty.change(function(){
            /* paramSchoolid.areaId = this.value;
             getarea(paramSchoolid,$school,url);*/
            if(this.value == "区/县"){
                return
            }
          /*  $schoolid = this.value;*/
            paramA.areaid = this.value;
           /* console.log($schoolid);*/
        });
        function getarea(a,b,url){
            $.ajax({
                url:basepath + url,
                type : 'POST',
                dataType:"json",
                data :{params :JSON.stringify(a)},
                success:function(data){
                    $.each(data.result,function(index,item){
                        var options = '<option value="' + item.areaId + '">' + item.areaName + '</option>;';
                        b.append(options);
                    })
                }
            });
        };
        //渲染修改页信息
        function getDres(a,b){
            a.id = b.id;
            a.password = b.password;
            a.mobile = b.mobile;
            a.areaId = b.areaId;
            a.fullName = b.fullName;
        }

        function idclear(){
            $selcity.children('option:not(:first)').remove();
            $selCounty.children('option:not(:first)').remove();
            $selcity.children('option:first').text("市");
            $selCounty.children('option:first').text("区/县");
            $selprovince.children('option:first').text("value='省/市'");
            $("#selProvice2 option[value='省/市']").prop("selected","selected")
        }

    });
</script>
</body>
</html>